{% extends "base.html" %}
{% load i18n %}
{% load link_helper %}
{% block head %}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.formset.js"></script>
<script type="text/javascript">
	$(function() {
		$('#client-contacts tr').formset({
			prefix : '{{ contact_formset.prefix }}',
			addText : 'Добавить контакт',
			deleteText : 'Удалить'
		});
	})
</script>
{% endblock %}

{% block left %}
<form action="" method="post" class="table-form">
	<table class="ui-widget ui-widget-content ui-corner-all">
		<thead>
			<tr>
				<td colspan="100%">
				<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix dialog-title">
					{{ dialig_title }}
					{% close_btn request.GET.next %}
				</div></td>
			</tr>
		</thead>		
		{{ form.as_table }}{% csrf_token %}		
		<tr><th>Создано:</th><td>{{ client.created }} {{ client.created_by }}</td></tr>		
		<tr><th>Обновлено:</th><td>{{ client.updated|default_if_none:'' }} {{ client.updated_by|default_if_none:'' }}</td></tr>
		
		<tr>
			<td colspan="100%"> {{ contact_formset.management_form }}
			<table id="client-contacts" class="inline-formset ui-widget ui-widget-content ui-corner-all">
				{% for contact in contact_formset %}
				{{ contact.id }}
				<tr>
					<td>{{ contact.contact_type.label_tag }}</td>
					<td>{{ contact.contact_type.errors }}{{ contact.contact_type }}</td>
					<td>{{ contact.contact.label_tag }}</td>
					<td>{{ contact.contact.errors }}{{ contact.contact }}</td>
					<td>{{ contact.contact_state.errors }}{{ contact.contact_state }}</td>
					<td>{% if contact.instance.pk %}{{ contact.DELETE }} {% endif %}</td>					
				</tr>
				<tr>
					<td colspan="100%">{{ contact.non_field_errors }}</td>
				</tr>

				{% endfor %}
				
			</table></td>
		</tr>
		<tfoot class="button">
			<tr>
				<td colspan="100%">
				<input value="{% trans 'Save and continue editing' %}" type="submit" name="_continue"/>
				<input value="{% trans 'Save' %}" type="submit" name="_save"/>
				</td>
			</tr>
		</tfoot>
	</table>

</form>

{% endblock %}

