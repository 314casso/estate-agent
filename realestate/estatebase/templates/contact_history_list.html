{% extends "base.html" %}
{% load i18n %}

{% block head %}
<script>
	$(function() {
		$(".table-grid tbody").find('#contact-list-{{ contact.pk }}').addClass('ui-state-highlight')
	});
</script>
{% endblock %}

{% block left %}
{% load query_string %}
{% load include %}

<form action="" method="POST" class="table-form">
	<table class="ui-widget ui-widget-content ui-corner-all">
		<thead>
			<tr>
				<td colspan="100%">
				<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix dialog-title">
					{{ contact }}
					{% close_btn request.GET.next %}
				</div></td>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td colspan="100%">
				<table>
					<tr>
						<th>Клиент:</th><td><a href="{% url client_update contact.client.pk %}?{{ next_url }}">{{ contact.client.name }}</a></td>
					</tr>
					<tr>
						<th>Вид:</th><td>{{ contact.client.client_type }}</td>
					</tr>
					<tr>
						<th>Место жительства:</th><td>{{ contact.client.address }}</td>
					</tr>
				</table></td>
			</tr>
		</tbody>
		<tbody>
			<tr>
				<td colspan="100%"> {% csrf_token %}
				{{ history_formset.management_form }}
				<table id="contact-history" class="inline-formset ui-widget ui-widget-content ui-corner-all">
					<tbody>
						{% for history in history_formset %}
						{{ history.id }}
						<tr>
							<td>{{ history.event_date.label_tag }}</td>
							<td>{{ history.event_date.errors }}{{ history.event_date }}</td>

							<td>{{ history.contact_state.label_tag }}</td>
							<td>{{ history.contact_state.errors }}{{ history.contact_state }}</td>
							<td>Удалить</td>
							<td>{% if history.instance.pk %}{{ history.DELETE }} {% endif %}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table></td>
			</tr>
		</tbody>
		<tfoot class="button">
			<tr>
				<td colspan="100%">
				<input value="{% trans 'Save and continue editing' %}" type="submit" name="_continue"/>
				<input value="{% trans 'Save' %}" type="submit" name="_save"/>
				</td>
			</tr>
		</tfoot>
	</table>
</form>
{% endblock %}

{% block right %}

<table class="ui-widget ui-widget-content ui-corner-all table-grid">
	<thead>
		<tr>
			<td>
			<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix dialog-title">
				Контакты
			</div></td>
		</tr>
	</thead>
	<tbody>
	{% for item in contact.client.contacts %}
	<tr>
		<td id="contact-list-{{ item.pk }}">
			<a href="{% url contact_history item.pk %}?next={{ request.GET.next }}">{{ item }}</a>
		</td>
	</tr>
	{% endfor %}
	</tbody>
</table>
{% endblock %}