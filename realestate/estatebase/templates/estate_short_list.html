{% extends "base.html" %}
{% load thumbnail %}

{% load query_string %}
{% load link_helper %}
{% load paginator %}
{% load humanize %}

{% block head %}
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}css/lightbox.css">
<script type="text/javascript" src="{{ STATIC_URL }}js/lightbox.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/simple-dialog.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.formset.js"> </script>
<script type="text/javascript">
	$(function() {
		$(".selected").addClass('ui-state-highlight');
		$("#tabs").tabs({
            select: function(event, ui) {
                localStorage.setItem('estate_id', '{{ estate.id }}');               
                localStorage.setItem('saved_tab', ui.index);                
            }, 
            selected : getIndex('{{ estate.id }}','saved_tab')  
        });

		$("#filter").dialog({
			modal : true,						
			width : 1150,
			title : 'Фильтр',
			//position : ['center', 170],
			autoOpen: false
		});
		        
	}); 

function showFilter(){
	$('#filter').dialog('open');
}

</script>

<link href="{{ STATIC_URL }}selectable/css/dj.selectable.css" type="text/css" media="all" rel="stylesheet" />
<script type="text/javascript" src="{{ STATIC_URL }}selectable/js/jquery.dj.selectable.js"></script>

{% endblock %}

{% block left %}

<input value="Показать фильтр" type="button" onclick="showFilter()">
<!--  -->
<div class="button table-form" id='filter'>
    <form method="get">        
        <table class="filter-table ui-widget ui-widget-content ui-corner-all" style="width:100%">
        	<tr>
        		<td class="top-align">
        			<table>	                
		            {% for field in fields|slice:":10" %}
					    <tr>
					    	<th>			        
					        {{ field.label_tag }}
					        </th>
					        <td>
					        {{ field.errors }}{{ field }}
					        </td>
					    </tr>
					{% endfor %}
					</table>
				</td>
				<td class="top-align">
					<table>	                
		            {% for field in fields|slice:"10:20" %}
					    <tr>
					    	<th>			        
					        {{ field.label_tag }}
					        </th>
					        <td>
					        {{ field.errors }}{{ field }}
					        </td>
					    </tr>
					{% endfor %}
				</table>				
				</td>	
				<td class="top-align">
					<table>	                
		            {% for field in fields|slice:"20:" %}
					    <tr>
					    	<th>			        
					        {{ field.label_tag }}
					        </th>
					        <td>
					        {{ field.errors }}{{ field }}
					        </td>
					    </tr>
					{% endfor %}
				</table>				
				</td>	
			</tr>                                          
            <tfoot>
                <tr>
                    <td colspan=3><a href="{{ request.path }}?next={{ request.GET.next|urlencode }}">Сбросить</a>
                    <input type="submit" value="Применить"/>
                    </td>
                </tr>
            </tfoot>
        </table>
    </form>
</div>
<!--  -->

Количество объектов: {{ total_count }}
{% if request.GET.next %}
<div class="button" ><a href="{{ request.GET.next }}">Вернуться к прежнему виду</a></div>
{% endif %}
<div class="button" style="text-align: left; margin: 0 0 10px 3px">
    <a data-width="450" title="Добавление нового объекта..." href="{% url select_estate_type estate.pk %}?{{ next_url }}" class="ajax-dialog">Добавить новый объект</a>
</div>
{% for estate_item in estate_list %}
<fieldset class="{% selected_css estate_item.pk estate.pk %} ui-widget ui-widget-content ui-corner-all" style="margin-top: 2px; padding: 4px 2px 3px 2px; width: 340px">
    <legend style="font-size: 11px;">
        <a href="{% url estate_list_details estate_item.pk %}{% query_string '' '' %}">[{{ estate_item.pk }}]</a>
        <a title="{{ estate_item.estate_type }}" href="{% url estate_list_details estate_item.pk %}{% query_string '' '' %}">{{ estate_item.estate_type|truncatechars:19 }}</a>
        <span title="{{ estate_item.estate_status }}" class="ui-corner-all ui-widget-content {{ estate_item.state_css }}" style="padding: 0 3px; font-size: 11px"> {{ estate_item.history.modificated|date:"d M Y" }} </span>
        {% if estate_item.agency_price %}
        <span class="ui-corner-all ui-widget-content" style="padding: 0 3px; margin-left: 1px"> {{ estate_item.agency_price|default_if_none:''|intcomma }} р. </span>
        {% endif %}

        {% if estate_item.correct %} <span title="Корректно" style="display: inline-block" class="ui-icon ui-icon-check"> </span> {% endif %} <a href="{% url estate_update estate_item.pk %}?{{ next_url }}"> <span style="display: inline-block" class="ui-icon ui-icon-wrench" > </span> </a>
    </legend>
    <div style="border-bottom: 0px solid #ddd; font-style: italic">
        {% address estate_item %}
    </div>
    <div style="margin-top: 2px">
        {% with contact=estate_item.basic_contact  %}
        {% if contact %}
        {{ contact.client.client_type }}
        <a href="{% url client_update contact.client.pk %}?{{ next_url }}">{{ contact.client.name }}</a>
        <span class="contact-inline {{ contact.state_css }}" title="{{ contact.contact_state }} ({{ contact.updated }})"> <label>{{ contact.contact_type }}:</label> <a href="{% url contact_update contact.pk %}?{{ next_url }}">{{ contact.contact }}</a></span>
        {% endif %}
        {% endwith %}
    </div>
</fieldset>

{% endfor %}

{% if is_paginated %}
<div class="pagination" style="float: left; padding-top:6px">
    {% digg_paginator %}
</div>
{% endif %}

{% endblock left %}

{% block right %}
<div id="tabs">
    <ul>
        <li>
            <a href="#tab-basic">Основная информация</a>
        </li>
        {% if estate.basic_bidg %}
        <li>
            <a href="#tab-bidgs">Детали</a>
        </li>
        {% endif %}
        <li>
            <a href="#tab-photos">Фотографии</a>
        </li>
    </ul>

    <div id="tab-basic">
        <div style="float: left">
            {% include "estate_dialog/basic.html" %}
            {% include "estate_dialog/salers.html" %}
        </div>
        <div style="float: left; margin-left: 10px">
            {% include "estate_dialog/comm.html" %}
            {% include "estate_dialog/marks.html" %}
            {% if estate.stead %}
            {% with stead=estate.basic_stead %}
            {% include "details/stead.html" %}
            {% endwith %}
            {% endif %}
        </div>
        <br style="clear: both" />
    </div>
    <div id="tab-bidgs">
        {% include estate.estate_type.object_type_template %}
    </div>
    <div id="tab-photos">
        {% include "estate_dialog/photo_base.html" %}
    </div>
</div>
{% endblock right %}
