{% extends "base.html" %}
{% load thumbnail %}

{% load query_string %}
{% load link_helper %}
{% load paginator %}
{% load humanize %}

{% block head %}
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}css/lightbox.css">
<script type="text/javascript" src="{{ STATIC_URL }}js/lightbox.js"> </script>
<script type="text/javascript" src="{{ STATIC_URL }}js/simple-dialog.js"> </script>
<style type="text/css">
	.detail-table td {
		border: 1px solid #ddd;
	}
	.ui-tabs-panel {
		padding: 4px 3px !important;
	}
</style>
<script type="text/javascript">
	$(function() {
		$(".selected").addClass('ui-state-highlight');
		$("#tabs").tabs({
			select: function(event, ui) {
				localStorage.setItem('estate_id', '{{ estate.id }}');				
                localStorage.setItem('saved_tab', ui.index);                
			}, 
			selected : getIndex('{{ estate.id }}','saved_tab')	
		});
	}); 
	
</script>
{% endblock %}

{% block left %}
<!--  -->
<div class="button table-form">
    <form method="get">
    	{{ estate_type_formset.management_form }}
        <table class="ui-widget ui-widget-content ui-corner-all">
            <thead>
                <tr>
                    <td colspan="2">
                    <div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix dialog-title">
                        Фильтр
                    </div></td>
                </tr>
            </thead>
            {{ estate_filter_form.as_table }}            
            {{ estate_type_formset }}          
            <tfoot>
                <tr>
                    <td colspan=2>
                    <a href="{{ request.path }}?next={{ request.GET.next|urlencode }}">Сбросить</a> 
                    <input type="submit" value="Применить"/>
                    </td>
                </tr>
            </tfoot>
        </table>
    </form>
</div>
<!--  -->


Количество объектов {{ total_count }}
{% if request.GET.next %}
 <a href="{{ request.GET.next }}">Вернуться к прежнему виду</a>
{% endif %}
<div class="button" style="text-align: left; margin: 0 0 10px 3px">
    <a data-width="450" title="Добавление нового объекта..." href="{% url select_estate_type estate.pk %}?{{ next_url }}" class="ajax-dialog">Добавить новый объект</a>
</div>
{% for estate_item in estate_list %}
<fieldset class="{% selected_css estate_item.pk estate.pk %} ui-widget ui-widget-content ui-corner-all" style="margin-top: 2px; padding: 4px 2px 3px 2px; width: 340px">
    <legend style="font-size: 11px;">        
        <a href="{% url estate_list_details estate_item.pk %}{% query_string '' '' %}">[{{ estate_item.pk }}]</a>
        <a title="{{ estate_item.estate_type }}" href="{% url estate_list_details estate_item.pk %}{% query_string '' '' %}">{{ estate_item.estate_type|truncatechars:19 }}</a>
        <span title="{{ estate_item.estate_status }}" class="ui-corner-all ui-widget-content {{ estate_item.state_css }}" style="padding: 0 3px; font-size: 11px"> {{ estate_item.history.modificated|date:"d M Y" }} </span>
        {% if estate_item.agency_price %}
        <span class="ui-corner-all ui-widget-content" style="padding: 0 3px; margin-left: 1px"> {{ estate_item.agency_price|default_if_none:''|intcomma }} р. </span>
        {% endif %}

        {% if estate_item.correct %} <span title="Корректно" style="display: inline-block" class="ui-icon ui-icon-check"> </span> {% endif %}
        <a href="{% url estate_update estate_item.pk %}?{{ next_url }}">
        	<span style="display: inline-block" class="ui-icon ui-icon-wrench" > </span>
        </a>
    </legend>
    <div style="border-bottom: 0px solid #ddd; font-style: italic">
        {% address estate_item %}
    </div>
    <div style="margin-top: 2px">
        {% with contact=estate_item.basic_contact  %}
        {% if contact %}
        {{ contact.client.client_type }}
        <a href="{% url client_update contact.client.pk %}?{{ next_url }}">{{ contact.client.name }}</a>
        <span class="contact-inline {{ contact.state_css }}" title="{{ contact.contact_state }} ({{ contact.updated }})"> <label>{{ contact.contact_type }}:</label> <a href="{% url contact_update contact.pk %}?{{ next_url }}">{{ contact.contact }}</a></span>
        {% endif %}
        {% endwith %}
    </div>
</fieldset>

{% endfor %}

{% if is_paginated %}
<div class="pagination" style="float: left; padding-top:6px">
    {% digg_paginator %}
</div>
{% endif %}

{% endblock left %}

{% block right %}
<div id="tabs">
    <ul>
        <li>
            <a href="#tab-basic">Основная информация</a>
        </li>
        {% if estate.basic_bidg %}
        <li>
            <a href="#tab-bidgs">Детали</a>
        </li>
        {% endif %}
        <li>
            <a href="#tab-photos">Фотографии</a>
        </li>
    </ul>

    <div id="tab-basic">
        <div style="float: left">
            {% include "estate_dialog/basic.html" %}
            {% include "estate_dialog/salers.html" %}
        </div>
        <div style="float: left; margin-left: 10px">
            {% include "estate_dialog/comm.html" %}
            {% include "estate_dialog/marks.html" %}
            {% if estate.stead %}
            {% with stead=estate.basic_stead %}
            {% include "details/stead.html" %}
            {% endwith %}
            {% endif %}
        </div>
        <br style="clear: both" />
    </div>
    <div id="tab-bidgs">
        {% include estate.estate_type.object_type_template %}
    </div>
    <div id="tab-photos">
        {% include "estate_dialog/photo_base.html" %}
    </div>
</div>
{% endblock right %}
