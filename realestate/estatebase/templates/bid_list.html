{% extends "base.html" %}
{% load link_helper %}
{% load query_string %}
{% load paginator %}
{% load humanize %}
{% block head %}


<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}css/jquery.dataTables.css">
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.dataTables.min.js"></script>
<link href="{{ STATIC_URL }}selectable/css/dj.selectable.css" type="text/css" media="all" rel="stylesheet" />
<script type="text/javascript" src="{{ STATIC_URL }}selectable/js/jquery.dj.selectable.js"></script>

<script type="text/javascript">
    $(function() {
        $(".selected").addClass('ui-state-highlight');
        $("#tabs").tabs({
            select: function(event, ui) {
                localStorage.setItem('estate_id', '{{ estate.id }}');               
                localStorage.setItem('saved_tab', ui.index);                
            }, 
            selected : getIndex('{{ estate.id }}','saved_tab')  
        });

        $("#filter").dialog({
            modal : true,                       
            width : 1150,
            title : 'Фильтр',
            //position : ['center', 170],
            autoOpen: false
        });                
        
        $("#bid-table").styleTable();
                        
    }); 
</script>

{% endblock %}

{% block left %}

<div class="topbar button">
<input value="Показать фильтр" type="button" onclick="showFilter('#filter')">
</div>

<table class="base-table-list ui-widget ui-widget-content">
	<thead>		
		<tr>
			<th>Код</th>
			<th>Вид недвижимости</th>
			<th>Цена</th>
			<th>Населенные пункты</th>
			<th>Обновлено</th>
			<th>Клиент</th>
			<th>Контакты</th>			
		</tr>
	</thead>
	<tbody class="ui-widget-content">
		{% for bid_item in bid_list %}
		<tr>
			<td><a href="{% url bid_update bid_item.pk %}?{{ next_url }}">{{ bid_item.pk }}</a></td>
			<td>
				{% for estate_type in bid_item.estate_types.all %}
            		<a href="{% url bid_update bid_item.pk %}?{{ next_url }}">{{ estate_type }}</a>{% include 'comma.html' %}
            	{% endfor %}
            </td>
            <td>{% two_num bid_item.agency_price_min bid_item.agency_price_max %}</td>
			<td>
				{% for locality in bid_item.localities.all %}
            		{{ locality }}{% include 'comma.html' %}
            	{% endfor %}
			</td>
			<td>{{ bid_item.history.modificated|date:"d M Y" }} </td>
			<td>{{ bid_item.client }}</td>
			<td>{% contact_list bid_item.client next_url 3 %}</td>			
		</tr>
		{% endfor %}
	</tbody>
</table>

{% if is_paginated %}
<div class="pagination" style="float: left; padding-top:6px">
    {% digg_paginator %}
</div>
{% endif %}

<!--  -->
<div class="button table-form" id='filter'>
    <form method="get">        
        <table class="filter-table ui-widget ui-widget-content ui-corner-all" style="width:100%">
            <tr>
                <td class="top-align">
                    <table>                 
                    {% for field in fields|slice:":10" %}
                        <tr>
                            <th>                    
                            {{ field.label_tag }}
                            </th>
                            <td>
                            {{ field.errors }}{{ field }}
                            </td>
                        </tr>
                    {% endfor %}
                    </table>
                </td>
                <td class="top-align">
                    <table>                 
                    {% for field in fields|slice:"10:20" %}
                        <tr>
                            <th>                    
                            {{ field.label_tag }}
                            </th>
                            <td>
                            {{ field.errors }}{{ field }}
                            </td>
                        </tr>
                    {% endfor %}
                </table>                
                </td>   
                <td class="top-align">
                    <table>                 
                    {% for field in fields|slice:"20:" %}
                        <tr>
                            <th>                    
                            {{ field.label_tag }}
                            </th>
                            <td>
                            {{ field.errors }}{{ field }}
                            </td>
                        </tr>
                    {% endfor %}
                </table>                
                </td>   
            </tr>                                          
            <tfoot>
                <tr>
                    <td colspan=3><a href="{{ request.path }}?next={{ request.GET.next|urlencode }}">Сбросить</a>
                    <input type="submit" value="Применить"/>
                    </td>
                </tr>
            </tfoot>
        </table>
    </form>
</div>
<!--  -->

{% endblock left %}